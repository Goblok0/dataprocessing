<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="d3/d3.js"></script>
    <style type="text/css">
        div.bar {
            display: inline-block;
            width: 5px;
            height: 5px;   /* We'll override this later */
            background-color: teal;
        }
        p.meh {
            color: blue;
        }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      d3.select("head")
        .append("title")
        .text("pahn");
      // d3.select("body")
      //   .append("p")
      //   .text("bar title")
      //   .attr("class", "meh");
      // d3.select("body")
      //   .append("p")
      //   .text("name: Julian Evalle stud_id: 11286369")
      //   .attr("class", "meh");
      d3.json("data.json").then(function(data) {

        var totDict = {}
        // ktoe = Kilotonne of Oil Equivalent
        totDict["KTOE"] = {};
        // primary energy
        totDict["PC_PRYENRGSUPPLY"] = {};
        // dict{year{country[]}}
        for (let key of Object.keys(data)){
          row = data[key];
          // do not use location
          country = row["LOCATION"];
          year = parseInt(row["TIME"]);
          value = parseInt(row["Value"]);
          if (!(value)){
            continue
          }
          measure = row["MEASURE"]
          dict = totDict[measure]

          if (!(dict[year])){
              dict[year] = {}
          };
          yearDict = dict[year]
          yearDict[country] = value;

        };
        var ktoeList = []
        // console.log(Object.keys(totDict["KTOE"]))
        for (let key of Object.keys(totDict["KTOE"])){
          // console.log(key)
          var yearAVG = 0
          countries = totDict["KTOE"][key]
          for (let countryKey of Object.keys(countries)){
              yearAVG += countries[countryKey]
          }
          division = Object.keys(countries).length
          yearAVG = yearAVG / division
          // console.log([key, yearAVG])
          ktoeList.push([key,yearAVG])

        }
        console.log(ktoeList)
        var w = 500;
        var h = 500;

        var dataLen = ktoeList.length
        var padding = w/100
        var dScaler = 75

        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);
        var rects = svg.selectAll("rect")
                       .data(ktoeList)
                       .enter()
                       .append("rect");

        // d3.select("body").selectAll("div")
        //   .data(ktoeList)
        //   .enter()
        //   .append("div")
        //   .attr("class", "bar")
        //   .style("height", function(d) {
        //       var barHeight = d/100;
        //       return barHeight + "px";
        //   });


        // var scale = d3.scaleLinear();
        var max = d3.max(ktoeList, function(d){
                                    return d[1];
                                  });
        var minYear = d3.min(ktoeList, function(d){
                                    return d[0];
                                  });
        var maxYear = d3.max(ktoeList, function(d){
                                    return d[0];
                                  });
        console.log(minYear)
        console.log(maxYear)

        var xScale = d3.scaleLinear()
                    .domain([minYear, maxYear])
                    .range([0, w]);
        var yScale = d3.scaleLinear()
                    .domain([0, max])
                    .range([h, 0]);

        rects.attr("x", function(d){
                       return xScale(d[0]);
                       })
             .attr("y", function(d){
                       return yScale(d[1]);
                       })
             .attr("width", w / (dataLen))
             .attr("height", function(d){
                            return h - yScale(d[1]);
                          })
             .attr("fill", function(d) {
                return "steelblue"
              });
        // y-axis
        svg.append("g")
         .call(d3.axisLeft(yScale));
        // x-axis
        svg.append("g")
           .attr("transform", `translate(0, ${h})`)
           .call(d3.axisBottom(xScale));

       // rects.attr("x", function(d, i) {
     		// 				return (i * (w / (dataLen) - padding ) + 25);
     		// 			  })
       //      .attr("y", function(d){
       //          return h - d/dScaler;
       //          })
   			// 	   .attr("width", w / (dataLen) - padding)
       //       .attr("height", function(d){
       //                      d = d/dScaler
       //                      return d;
       //        })
       //       // color function provided by http://alignedleft.com/tutorials/d3/making-a-bar-chart
       //       .attr("fill", function(d) {

       //         return "rgb(0,0," + (d / dScaler * 0.6) + ")"
       //       });

       //  var xAxis = d3.svg.axis()
       //                    .scale(xScale)
       //                    .orient("bottom");
       //
       //
       //
       //  // placed at end of script
       //  svg.append("g")
       //     .call(xAxis)
       });
      // })






      // const yearAverage = function(x){
      //   for (let key of Object.keys(totDict["KTOE"])){
      //
      //     var yearAVG = 0
      //     countries = totDict["KTOE"][key]
      //     for (let countryKey of Object.keys(countries)){
      //         yearAVG += countries[countryKey]
      //     }
      //     division = Object.keys(countries).length
      //     yearAVG = yearAVG / division
      //     ktoeList.push(yearAVG)
      //
      //     // ktoeList.push(ktoeDict[key])
      //   }
      // }
    </script>
  </body>
</html>
