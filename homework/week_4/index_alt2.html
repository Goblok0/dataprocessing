<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="d3/d3.js"></script>
    <style type="text/css">
        div.bar {
            display: inline-block;
            width: 5px;
            height: 5px;   /* We'll override this later */
            background-color: teal;
        }
        p.meh {
            color: blue;
        }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      d3.select("head")
        .append("title")
        .text("pahn");

      d3.json("data.json").then(function(data) {

        var totDict = {}
        // ktoe = Kilotonne of Oil Equivalent
        totDict["KTOE"] = {};
        // primary energy
        totDict["PC_PRYENRGSUPPLY"] = {};
        // dict{year{country[]}}
        for (let key of Object.keys(data)){
            row = data[key];
            // do not use location
            country = row["LOCATION"];
            year = parseInt(row["TIME"]);
            value = parseInt(row["Value"]);
            if (!(value)){
                continue
            }
            measure = row["MEASURE"]
            dict = totDict[measure]

            if (!(dict[year])){
                dict[year] = {}
            };
            yearDict = dict[year]
            yearDict[country] = value;

        };
        var ktoeList = []
        // console.log(Object.keys(totDict["KTOE"]))
        for (let key of Object.keys(totDict["KTOE"])){
          // console.log(key)
          var yearAVG = 0
          countries = totDict["KTOE"][key]
          for (let countryKey of Object.keys(countries)){
              yearAVG += countries[countryKey]
          }
          division = Object.keys(countries).length
          yearAVG = yearAVG / division
          // console.log([key, yearAVG])
          ktoeList.push([key,yearAVG])

        }
        console.log(ktoeList)

        var width = 500;
        var height = 500;

        pad = {
          top: height/10,
          bottom: height/17,
          left: width/10,
          right: width/25
        };

        var w = width - pad.left - pad.right;
        var h = height - pad.top - pad.bottom;

        var dataLen = ktoeList.length

        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
        var rects = svg.selectAll("rect")
                       .data(ktoeList)
                       .enter()
                       .append("rect");

        var min = d3.min(ktoeList, function(d){
                                   return d[1];
                                 });
        var max = d3.max(ktoeList, function(d){
                                    return d[1];
                                  });
        var minYear = d3.min(ktoeList, function(d){
                                    return d[0];
                                  });
        var maxYear = d3.max(ktoeList, function(d){
                                    return d[0];
                                  });

        var xScale = d3.scaleLinear()
                    .domain([minYear, maxYear])
                    .range([0, w]);
        var yScale = d3.scaleLinear()
                    .domain([0, max])
                    .range([h, 0]);
        var colScale = d3.scaleLinear()
                         .domain([0,max])
                         .range([0,255])

        rects.attr("x", function(d){
                       return xScale(d[0]) + width * 0.05;
                       })
             .attr("y", function(d){
                       return yScale(d[1]);
                       })
             .attr("width", w / (dataLen))
             .attr("height", function(d){
                            return h - yScale(d[1]);
                          })
            .attr("fill", function(d) {
              // colScale works, but colour is only black or blue
              return "rgb(0,0," + (colScale(d)) + ")"
            });


        // x-axis
        var x_axis = d3.axisBottom()
                       .scale(xScale);


        // x-axis
        svg.append("g")
           .call(x_axis);


       });






      // const yearAverage = function(x){
      //   for (let key of Object.keys(totDict["KTOE"])){
      //
      //     var yearAVG = 0
      //     countries = totDict["KTOE"][key]
      //     for (let countryKey of Object.keys(countries)){
      //         yearAVG += countries[countryKey]
      //     }
      //     division = Object.keys(countries).length
      //     yearAVG = yearAVG / division
      //     ktoeList.push(yearAVG)
      //
      //     // ktoeList.push(ktoeDict[key])
      //   }
      // }
    </script>
  </body>
</html>
